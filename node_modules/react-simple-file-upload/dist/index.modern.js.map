{"version":3,"file":"index.modern.js","sources":["../src/index.js"],"sourcesContent":["import React, { useRef, useEffect, createContext, useContext } from 'react'\nimport shortid from 'shortid'\nimport makeDebug from 'debug'\n\nexport const SimpleFileUploadContext = createContext({\n  apiKey: '',\n  width: 160,\n  height: 160\n})\n\nexport const useSimpleFileUpload = () => useContext(SimpleFileUploadContext)\n\nexport const SimpleFileUploadProvider = ({\n  apiKey,\n  width,\n  height,\n  children\n}) => {\n  const value = {\n    apiKey,\n    width: +width,\n    height: +height\n  }\n\n  return (\n    <SimpleFileUploadContext.Provider value={value}>\n      {children}\n    </SimpleFileUploadContext.Provider>\n  )\n}\n\n// Add a localStorage entry with the key `debug` and value `SimpleFileUpload` to see debug messages\nconst debug = makeDebug('SimpleFileUpload')\n\nconst SimpleFileUpload = ({ apiKey, onSuccess, onDrop, width, height, preview, text, resizeWidth, resizeHeight, resizeMethod, tag, accepted, maxFileSize }) => {\n  const sfu = useSimpleFileUpload()\n  const key = sfu.apiKey || apiKey\n  width = width || sfu.width\n  height = height || sfu.height\n  text = text || \"Drop file to upload\"\n  resizeMethod = resizeMethod || \"contain\"\n\n  let small = \"false\"\n\n  if (parseInt(width) < 120) {\n    small = \"true\"\n  }\n\n  const widgetId = useRef(shortid.generate())\n\n  useEffect(() => {\n    window.addEventListener('message', handleIframeMessage, false)\n    return () => {\n      window.removeEventListener('message', handleIframeMessage)\n    }\n  })\n  const handleIframeMessage = (e) => {\n    if (e.origin !== 'https://app.simplefileupload.com') {\n      return\n    }\n    // Handle errors (Need iframe to emit an uploadResult of error)\n    if (e.data.uploadResult === 'success') {\n      if (e.data.widgetId !== widgetId.current) {\n        debug('Ignoring because widgetId does not match')\n        return\n      }\n      if (e.data.widgetId === widgetId.current) {\n        debug('Success: %O', e.data)\n        onSuccess(e.data.url)\n      }\n    }\n\n    if (e.data.event === 'dropStarted') {\n      if (e.data.widgetId !== widgetId.current) {\n        debug('Ignoring because widgetId does not match')\n        return\n      }\n      if (e.data.widgetId === widgetId.current) {\n        debug('Success: %O', e.data)\n        if(typeof onDrop === 'function') { onDrop(e.data.url); }\n      }\n    }\n  }\n\n  return (\n    <iframe\n      title={`Simple File Upload ${widgetId.current}`}\n      src={`https://app.simplefileupload.com/buckets/${key}?widgetId=${widgetId.current}&preview=${preview}&text=${text}&small=${small}&resizeWidth=${resizeWidth}&resizeHeight=${resizeHeight}&resizeMethod=${resizeMethod}&tag=${tag}&accepted=${accepted}&maxFileSize=${maxFileSize}`}\n      className='widgetFrame'\n      width={width}\n      height={height}\n      style={{\n        border: 0\n      }}\n    />\n  )\n}\n\nexport default SimpleFileUpload\n"],"names":["SimpleFileUploadContext","createContext","apiKey","width","height","useSimpleFileUpload","useContext","SimpleFileUploadProvider","children","value","debug","makeDebug","SimpleFileUpload","onSuccess","onDrop","preview","text","resizeWidth","resizeHeight","resizeMethod","tag","accepted","maxFileSize","sfu","key","small","parseInt","widgetId","useRef","shortid","generate","useEffect","window","addEventListener","handleIframeMessage","removeEventListener","e","origin","data","uploadResult","current","url","event","border"],"mappings":"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"}